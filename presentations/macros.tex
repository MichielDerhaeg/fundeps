% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                             General Utilities
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% \newcommand{\TODO}{\begin{color}{red}{\texttt{TODO}}\end{color}\xspace}
% \newcommand{\todo}[1]{\begin{color}{red}{#1}\end{color}}

%\newcommand{\george}[1]{\begin{color}{violet}{\bf George:} {#1}\end{color}}
% \newcommand{\george}[1]{\todo{\textbf{George:} {#1}}}
% \newcommand{\ADDREF}{\todo{\texttt{REF}}\xspace}

\newcommand{\ticket}[1]{\href{https://ghc.haskell.org/trac/ghc/ticket/#1}{\##1}}
\newcommand{\SystemFC}{System F$_\text{C}$\xspace}
\newcommand{\SystemF}{System F\xspace}
\newcommand{\HM}[1]{{\rm {\sc HM}(#1)}\xspace}
\newcommand{\OutsideIn}[1]{{\rm {\sc OutsideIn}(#1)}\xspace}
\newcommand{\ruleform}[1]{\fbox{$#1$}}

\definecolor{superlightgray}{gray}{0.80}
\newcommand{\highlight}[1]{\setlength{\fboxsep}{2pt}\colorbox{superlightgray}{\ensuremath{#1}}}

\newcommand{\fv}[1]{\mathit{fv}(#1)}
\newcommand{\fuv}[1]{\mathit{fuv}(#1)}
\newcommand{\dom}[1]{\mathit{dom}(#1)}
\newcommand{\codom}[1]{\mathit{codom}(#1)}
\newcommand{\fand}{\textit{and}}
\newcommand{\fif}{\textit{if}}
\newcommand{\fthen}{\textit{then}}
\newcommand{\felse}{\textit{else}}

\newcommand{\proof}{\textsc{Proof: }}
\newcommand{\proofStep}[3]{{\small \ruleform{\textbf{#1}}} \quad ${#2}$ \\
                           \begin{addmargin}[2em]{0em}
                             {#3}
                           \end{addmargin}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                            Other Utilities
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\syntaxLine}[4]{${#1}$ & ${#2}$ & ${#3}$ & $\textit{#4}$ }
\newcommand{\syntaxLineH}[4]{$\highlight{{#1}}$ & $\highlight{{#2}}$ & $\highlight{{#3}}$ & $\textit{\highlight{#4}}$ }
\newcommand{\namedRuleform}[2]{{\small $\ruleform{#1}$} \quad {#2}}
\newcommand{\vdashNamedD} [1]{\vdash_{{\scriptscriptstyle \hspace{-1mm}\mathtt{#1}}}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                                Syntax
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% Symbol Classes
\newcommand{\TC}{\mathit{TC}}

% Declarations and Programs
\newcommand{\clsDecl}{\mathit{cls}}
\newcommand{\instDecl}{\mathit{inst}}
\newcommand{\program}{\mathit{pgm}}
\newcommand{\decl}{\mathit{decl}}

% Types
\newcommand{\monotype}{\tau}
\newcommand{\qualtype}{\rho}
\newcommand{\polytype}{\sigma}
\newcommand{\monotypes}{\overline{\monotype}}
\newcommand{\qualtypes}{\overline{\qualtype}}
\newcommand{\polytypes}{\overline{\polytype}}

% Environments
\newcommand{\tyEnv}{\Gamma}
% \newcommand{\programTheory}{\mathit{P}}%{\mathcal{P}}
% \newcommand{\annProgramTheory}{\mathcal{P}}
% \newcommand{\programTheoryA}{\mathit{A}}
\newcommand{\programTheory}{\mathit{A}}%{\mathcal{P}}
\newcommand{\fullTheory}{\mathit{P}}%{\mathcal{A}}
\newcommand{\instanceTheory}{\programTheory_I}
\newcommand{\superTheory}   {\programTheory_S}
\newcommand{\localTheory}   {\programTheory_L}

\newcommand{\commaL}{,_{\mbox{\tiny L}}}
\newcommand{\commaS}{,_{\mbox{\tiny S}}}
\newcommand{\commaI}{,_{\mbox{\tiny I}}}

\newcommand{\annProgramTheory}{\mathcal{A}}
\newcommand{\annFullTheory}{\mathcal{P}}
\newcommand{\annInstanceTheory}{\annProgramTheory_I}
\newcommand{\annSuperTheory}   {\annProgramTheory_S}
\newcommand{\annLocalTheory}   {\annProgramTheory_L}

% Constraints
\newcommand{\cconstraint}{\mathit{C}}%{\mathcal{C}}
\newcommand{\annConstraint}{\mathcal{C}}

\newcommand{\constraints}{\overline{\constraint}}
\newcommand{\annConstraints}{\overline{\annConstraint}}

\newcommand{\classConstraint}{\mathit{Q}}%{\mathcal{Q}}
\newcommand{\annClassConstraint}{\mathcal{Q}}%{\mathcal{Q}}

\newcommand{\constraintScheme}{\mathit{R}}
\newcommand{\constraintSchemeInstance}{\constraintScheme_I}
\newcommand{\constraintSchemeSuper}{\constraintScheme_S}
\newcommand{\constraintSchemeLocal}{\constraintScheme_L}

% Keywords
\newcommand{\flet}     {\normalfont{\textbf{let}}}
\newcommand{\fin}      {\normalfont{\textbf{in}}}
\newcommand{\fcls}     {\mathit{cls}}
\newcommand{\fclass}   {\normalfont{\textbf{class}}}
\newcommand{\finst}    {\mathit{inst}}
\newcommand{\finstance}{\normalfont{\textbf{instance}}}
\newcommand{\fwhere}   {\normalfont{\textbf{where}}}
\newcommand{\fnewtype} {\normalfont{\textbf{newtype}}}
\newcommand{\fresh}{\text{fresh}}

% MISC.
\newcommand{\tySubst}{\theta}
\newcommand{\dictSubst}{\eta}
\newcommand{\singleSubst}[3]{[{#2} / {#1}] {#3}}

\newcommand{\as}{\overline{a}}
\renewcommand{\bs}{\overline{b}}
\renewcommand{\cs}{\overline{c}}
\newcommand{\ds}{\overline{d}}

\newcommand{\xs}{\overline{x}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                                 General
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\match}[2]{\mathit{match}({#1},{#2})}
\newcommand{\nat}{Nat}
\newcommand{\bool}{Bool}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                            STLC Type System
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\newcommand{\eval}{\rightarrow}
\newcommand{\evalRec}{\rightarrow^*}
\newcommand{\tcTermSTLC}[3]{{#1} \vdashNamedD{tm} {#2} : {#3}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                         Declarative Type System
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\tcTerm}[4]{{#1}; {#2} \vdashNamedD{tm} {#3} : {#4}}
\newcommand{\tcType}[2]{{#1} \vdashNamedD{ty} {#2}}
\newcommand{\tcConstraint}[2]{{#1} \vdashNamedD{ct} {#2}}
\newcommand{\tcAxiom}[2]{{#1} \vdashNamedD{ax} {#2}}
\newcommand{\tceAxiom}[3]{{#1} \vdashNamedD{ax} {#2} \rightsquigarrow {#3}}
\newcommand{\proveConstraintSimple}[2]{{#1} \models {#2}}
\newcommand{\proveConstraintDict}[4]{{#1} \models {#2} \rightsquigarrow {#3} ; {#4}}
\newcommand{\proveConstraint}[3]{{#1} ; {#2} \models {#3}}
\newcommand{\proveConstraintA}[3]{{#1} ; {#2} \models_A {#3}}
\newcommand{\proveConstraintF}[3]{{#1} ; {#2} \models_F {#3}}
\newcommand{\proveConstraintRem}[4]{{#1} ; {#2} \models {#3} \rightsquigarrow {#4}}
\newcommand{\tcClsDeclSimple}[3]{{#1} \vdashNamedD{cls} {#2} : {#3}}
\newcommand{\tcClsDecl}[4]{{#1} \vdashNamedD{cls} {#2} : {#3}; {#4}}
\newcommand{\tcInstDecl}[4]{{#1} ; {#2} \vdashNamedD{inst} {#3} : {#4}}
\newcommand{\tcProgram}[6]{{#1} ; {#2} \vdashNamedD{pgm} {#3} : {#4} ; {#5} ; {#6}}

\newcommand{\unambiguousName}{\mathit{unamb}}
\newcommand{\unambiguous}[1]{\unambiguousName({#1})}
\newcommand{\unambiguousAux}[2]{{#1} \vdashNamedD{unamb} {#2}}

\newcommand{\tcProgramShort}[2]{\vdashNamedD{pgm} {#1} : {#2}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                             Type Inference
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\project}[3]{\mathit{proj^{#1}_{#2}}({#3})}

\newcommand{\equalities}{\mathit{E}}

\newcommand{\alphas}{\overline{\alpha}}
\newcommand{\betas} {\overline{\beta}}
\newcommand{\gammas}{\overline{\gamma}}

\newcommand{\unifyName}{\mathit{unify}}
\newcommand{\unify}[2]{\unifyName({#1} ; {#2})}

\newcommand{\inferTermHM}[4]{{#1} \vdashNamedD{tm} {#2} : {#3} \mid {#4}}
\newcommand{\inferTermHME}[5]{{#1} \vdashNamedD{tm} {#2} : {#3} \highlight{\rightsquigarrow {#4}} \mid {#5}}
\newcommand{\inferTerm}[5]{{#1} \vdashNamedD{tm} {#2} : {#3} \mid {#4} ; {#5}}

% Attempt 1:
% ~~~~~~~~~~
\newcommand{\rightRule}[3]{{#1} ; {#2} \models [{#3}]}
\newcommand{\leftRule}[4]{{#1} ; [{#2}] \models {#3} \rightsquigarrow {#4}}

% Attempt 2:
% ~~~~~~~~~~
\newcommand{\entailRight}[4]{{#1} ; {#2} \models [{#3}] \rightsquigarrow {#4}}
\newcommand{\entailRightRec}[4]{{#1} ; {#2} \models {#3} \rightsquigarrow^! {#4}}

\newcommand{\entailLeft}[5]{{#1} ; [{#2}] \models {#3} \rightsquigarrow {#4} ; {#5}}
\newcommand{\entailLeftShort}[4]{{#1} ; [{#2}] \models {#3} \rightsquigarrow {#4}}

\newcommand{\entailClosure}[4]{{#1} ; {#2} \models {#3} \rightsquigarrow^* {#4}}
\newcommand{\entailClosureFinal}[4]{{#1} ; {#2} \models {#3} \rightsquigarrow^! {#4}}

% Bottom up:
% ~~~~~~~~~~
\newcommand{\entailBottomUp}[4]{{#1} ; {#2} ; [{#3}] \models {#4}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                             Elaboration
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\tceTerm}[6]{{#1} \vdashNamedD{tm} {#2} : {#3} \highlight{\rightsquigarrow {#4}} \mid {#5} ; {#6}}
\newcommand{\tceType}[2]{\vdashNamedD{ty} {#1} \rightsquigarrow {#2}}
\newcommand{\tceConstraint}[2]{\vdashNamedD{ct} {#1} \rightsquigarrow {#2}}
\newcommand{\tceClass}[6]{{#1} \vdashNamedD{cls} {#2} : {#3} ; {#4} \highlight{\rightsquigarrow {#5} ; {#6}}}
\newcommand{\tceInstance}[5]{{#1} ; {#2} \vdashNamedD{inst} {#3} : {#4} \highlight{\rightsquigarrow {#5}}}
\newcommand{\tceProgram}[5]{{#1} ; {#2} \vdashNamedD{pgm} {#3} : {#4} \highlight{\rightsquigarrow {#5}}}
\newcommand{\tceTyEnv}[2]{{#1} \highlight{\rightsquigarrow {#2}}}

\newcommand{\tceTypeDouble}[3]{{#1} \vdashNamedD{ty} {#2} \highlight{\rightsquigarrow {#3}}}
\newcommand{\tceConstraintDouble}[3]{{#1} \vdashNamedD{ct} {#2} \highlight{\rightsquigarrow {#3}}}
\newcommand{\tceClassSimple}[4]{{#1} \vdashNamedD{cls} {#2} : {#3} \highlight{\rightsquigarrow {#4}}}

\newcommand{\entailRightE}[5]{{#1} ; {#2} \models [{#3}] \rightsquigarrow {#4} \highlight{; {#5}}}
\newcommand{\entailRightEAnn}[6]{{#1} ; {#2} \models [{#3}] \rightsquigarrow {#4} \highlight{; {#5}} ; {#6}}
\newcommand{\entailRightEAnnA}[6]{{#1} ; {#2} \models_A [{#3}] \rightsquigarrow {#4} \highlight{; {#5}} ; {#6}}
\newcommand{\entailRightEAnnB}[6]{{#1} ; {#2} \models_B [{#3}] \rightsquigarrow {#4} \highlight{; {#5}} ; {#6}}
\newcommand{\entailRightERec}[5]{{#1} ; {#2} \models {#3} \rightsquigarrow {#4} ; \highlight{{#5}}}
\newcommand{\entailRightERecAnn}[6]{{#1} ; {#2} \models {#3} \rightsquigarrow {#4} ; \highlight{{#5}} ; {#6}}
\newcommand{\entailRightERecAnnA}[6]{{#1} ; {#2} \models_A {#3} \rightsquigarrow {#4} ; \highlight{{#5}} ; {#6}}
\newcommand{\entailRightERecAnnB}[6]{{#1} ; {#2} \models_B {#3} \rightsquigarrow {#4} ; \highlight{{#5}} ; {#6}}
\newcommand{\entailLeftE}[6]{{#1} ; [{#2}] \models {#3} \rightsquigarrow {#4} ; {#5} \highlight{; {#6}}}
\newcommand{\entailLeftEA}[6]{{#1} ; [{#2}] \models_A {#3} \rightsquigarrow {#4} ; {#5} \highlight{; {#6}}}
\newcommand{\entailLeftEAlg}[7]{{#1} ; [{#2}] \models {#3} \mid ({#4} \highlight{; {#5}}) \rightsquigarrow ({#6} \highlight{; {#7}})}
\newcommand{\entailLeftEAlgAnn}[8]{{#1} ; [{#2}] \models {#3} \mid ({#4} \highlight{; {#5}}) \rightsquigarrow ({#6} \highlight{; {#7}}) ; {#8}}
\newcommand{\entailLeftEAlgAnnB}[8]{{#1} ; [{#2}] \models_B {#3} \mid ({#4} \highlight{; {#5}}) \rightsquigarrow ({#6} \highlight{; {#7}}) ; {#8}}
\newcommand{\entailLeftEShort}[5]{{#1} ; [{#2}] \models {#3} \rightsquigarrow {#4} \highlight{; {#5}}}
\newcommand{\subsumesE}[6]{{#1} ; {#2} ; {#3} \vdashNamedD{tm} {#4} : {#5} \highlight{\rightsquigarrow {#6}}}

\newcommand{\tceProgramShort}[3]{\vdashNamedD{pgm} {#1} : {#2} \highlight{\rightsquigarrow {#3}}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                             System F Syntax
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\feval}{\rightarrow^F}

\newcommand{\ftype}{\upsilon}
\newcommand{\ftypes}{\overline{\ftype}}
\newcommand{\fval}{\mathit{fval}}
\newcommand{\fdt}{\mathit{fdata}}
\newcommand{\fprogram}{\mathit{fpgm}}
\newcommand{\fpattern}{\mathit{p}}

\newcommand{\fof}{\normalfont{\textbf{of}}}
\newcommand{\fcase}{\normalfont{\textbf{case}}}
\newcommand{\fdata}{\normalfont{\textbf{data}}}
\newcommand{\tyCon}{\mathit{T}}
\newcommand{\dataCon}{\mathit{K}}
\newcommand{\keytype}{\normalfont{\textbf{type}}}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                             System F Typing
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\fvdashNamedD}[1]{\vdashNamedD{#1}^{{\scriptscriptstyle \hspace{-0.5mm}\mathtt{F}}}}

\newcommand{\fTcTerm}[3]{{#1} \fvdashNamedD{tm} {#2} : {#3}}
\newcommand{\fTcType}[2]{{#1} \fvdashNamedD{ty} {#2}}
\newcommand{\fTcVal}[3]{{#1} \fvdashNamedD{val} {#2} : {#3}}
\newcommand{\fTcData}[3]{{#1} \fvdashNamedD{data} {#2} : {#3}}
\newcommand{\fTcProgram}[3]{{#1} \fvdashNamedD{pgm} {#2} : {#3}}

\newcommand{\fTyEnv}{\Delta}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                           Metatheory Utilities
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\headName}{\mathit{head}}
\newcommand{\head}[1]{\headName({#1})}
\newcommand{\tchName}{\mathit{tch}}
\newcommand{\tch}[1]{\tchName({#1})}

\newcommand{\norm}[1]{\lVert{#1}\rVert}

\newcommand{\occurrencesName}[1]{\mathit{occ}_{#1}}
\newcommand{\occurrences}[2]{\occurrencesName{#1}({#2})}

\newcommand{\terminatingName}{\mathit{term}}
\newcommand{\terminating}[1]{\terminatingName({#1})}

\newcommand{\subsumption}[4]{{#1} ; {#2} \models {#3} \preceq {#4}}

\newcommand{\wfCodom}[2]{{#1} \vdashNamedD{codom} {#2}}

\newcommand{\fWfTyEnv}[1]{\fvdashNamedD{wf} {#1}} % System F environment well-formedness
\newcommand{\wfTyEnv}[1]{\vdashNamedD{wf} {#1}}   % Source environment well-formedness

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%                       System F Operational Semantics
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\newcommand{\opSem}[2]{{#1} \longrightarrow {#2}}
